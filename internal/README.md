了解、CLIベースを基本として開発し、機能が揃ったらTUIを追加する方針で、
**構成・機能一覧**をMarkdown形式でまとめ直します。
コピペしやすくしてあるので、そのままドキュメント化にも使えます。

---

markdown
# QuickPort - 構成と機能一覧

## 🎯 概要

QuickPort は、**サーバーレスかつ高速なP2P通信**を提供する Go 製アプリケーションです。  
複数端末間で **テキスト・ファイル・音声**を共有でき、**接続トークンとUDP通信によるNAT越え**に対応します。

---

## ✅ 前提条件

- 完全サーバーレス（P2P）
- UDPベースの通信
- NAT越えは STUN + UDP Hole Punching
- 接続は「トークン」ベース（事前共有）
- TURNは使用しない（STUNまで）

---

## 🧩 機能一覧

### 🌐 ネットワーク通信
- UDP通信（直接接続）
- NAT越え（UDP Hole Punching）
- STUNクライアントによる外部アドレス取得

### 🔐 接続・認証
- 接続トークンの生成（接続情報を含む）
- トークン入力で接続確立
- （将来的に）公開鍵暗号ハンドシェイク

### 💬 通信機能
- テキスト送受信（リアルタイム）
- ファイル共有（DLリクエスト方式）
  - 受信者がDLするまで送信は開始しない
  - 自動DL or 手動確認が選択可能
- 音声ストリーミング（Opus or PCM圧縮予定）

### 📡 ピア管理
- ピアの存在確認（Ping/Pong）
- オンライン一覧の表示
- 転送中ステータス表示（進捗等）

### 🖥 ユーザーインターフェース
- CLI（基本開発段階で使用）
- TUI（後で導入、tviewなど予定）
- GUI（将来的に Wails などで構築可能）

---

## 🏗 ディレクトリ構成案



quickport/
├── cmd/quickport/          # エントリポイント
├── core/
│   ├── peer.go             # ピア接続と管理
│   ├── network.go          # STUN、Hole Punch、UDP通信
│   ├── file\_transfer.go    # ファイル転送管理
│   ├── audio\_stream.go     # 音声ストリーム
│   └── message.go          # テキスト・コマンド構造
├── token/
│   └── token.go            # 接続トークン生成・パース
├── ui/
│   ├── cli.go              # CLI操作
│   └── tui.go              # TUI表示（任意）
├── config/
│   └── config.go           # 設定ファイル管理
├── utils/
│   └── logger.go           # ログ出力など
└── go.mod

`

---

## 🔄 接続フロー例

1. **ユーザーA**  
   bash
   quickport generate-token
`

→ トークン生成（外部アドレス + UUID）

2. **ユーザーB**

   bash
   quickport connect --token <Aのトークン>
   

   → STUNで外部ポート取得
   → UDPホールパンチング

3. **接続確立**
   → テキスト/ファイル/音声共有が可能に

---

## 🔜 次ステップ（開発順）

1. `peer.go` / `network.go` による UDP + NAT越え構成のミニマル実装
2. `token.go` によるトークン生成/解析の実装
3. `cli.go` によるコマンド操作（共有・接続・送信など）



---

この構成をベースに開発を進めると明確な段階で作れると思う。  
次に進めたいところ（例：トークン形式設計 or UDP通信の骨組み）を教えてくれれば、そっち用のコード書き出せる。

